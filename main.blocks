<xml xmlns="https://developers.google.com/blockly/xml"><variables><variable type="KIND_SpriteKind" id="B%qWRlPr+0N9RU,DLGD:">gemsPlayer</variable><variable type="KIND_SpriteKind" id="**!tk/3x!P63$GZwt8f~">gemsCatcher</variable><variable type="KIND_SpriteKind" id="e$!B8wf:ok3Ku=uzuiI4">gems</variable><variable type="KIND_SpriteKind" id="e@}4gaN0)nsxeL6[2E~]">getGemsKind</variable><variable type="KIND_SpriteKind" id="_nJI*!Tsq!Ya#+0@5ikr">gemsKind</variable></variables><block type="pxt-on-start" x="10" y="10"><statement name="HANDLER"><block type="typescript_statement" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="namespace getgems {" line1="" line2="//碰到墙回退事件" line3="scene.onOverlapTile(SpriteKind.gemsPlayer, sprites.builtin.forestTiles0, function (sprite, location) {" line4="    if (heroDirection == 3) {" line5="        heroRow += -1" line6="    } else if (heroDirection == 0) {" line7="        heroCol += -1" line8="    } else if (heroDirection == 1) {" line9="        heroRow += 1" line10="    } else if (heroDirection == 2) {" line11="        heroCol += 1" line12="    }" line13="    scene.cameraShake(4, 500)" line14="    tiles.placeOnTile(gemsHero, tiles.getTileLocation(heroRow, heroCol))" line15="})" line16="" line17="//获得宝石事件" line18="sprites.onOverlap(SpriteKind.gemsCatcher, SpriteKind.gems, function(sprite: Sprite, otherSprite: Sprite) {" line19="    otherSprite.destroy()" line20="    info.player1.changeScoreBy(-1)" line21="})" line22="sprites.onOverlap(SpriteKind.getGemsKind, SpriteKind.gemsKind, function(sprite: Sprite, otherSprite: Sprite) {" line23="    otherSprite.destroy()" line24="    info.player1.changeScoreBy(-1)" line25="    gemsNum-=1" line26="})" line27="" line28="//关卡设定" line29="function levelset(level:number){" line30="   switch(level){" line31="&#9;&#9;&#9;&#9;case 1:" line32="                     tiles.setTilemap(tiles.createTilemap(hex`0a0008000202020202020202020202020202020202020202020202020202020202020202020102020202020202020203020202020202020202020202020202020202020202020202020202020202020202020202`, img`" line33="                         . . . . . . . . . ." line34="                         . . . . . . . . . ." line35="                         . . . . . . . . . ." line36="                         . . . . . . . . . ." line37="                         . . . . . . . . . ." line38="                         . . . . . . . . . ." line39="                         . . . . . . . . . ." line40="                         . . . . . . . . . ." line41="                     `, [myTiles.transparency16,sprites.dungeon.buttonTealDepressed,sprites.builtin.forestTiles0,sprites.dungeon.collectibleInsignia], TileScale.Sixteen))   " line42="&#9;&#9;&#9;&#9;&#9;break;" line43="&#9;&#9;&#9;&#9;case 2:" line44="                    tiles.setTilemap(tiles.createTilemap(hex`0a0008000101010101010101010101010101010101010101010101030000000001010101010000010002010101010101020100010101010101010000000101010101010101010101010101010101010101010101`, img`" line45="                        . . . . . . . . . ." line46="                        . . . . . . . . . ." line47="                        . . . . . . . . . ." line48="                        . . . . . . . . . ." line49="                        . . . . . . . . . ." line50="                        . . . . . . . . . ." line51="                        . . . . . . . . . ." line52="                        . . . . . . . . . ." line53="                    `, [myTiles.transparency16,sprites.builtin.forestTiles0,sprites.dungeon.collectibleInsignia,sprites.dungeon.buttonTealDepressed], TileScale.Sixteen))" line54="                    break;" line55="&#9;&#9;&#9;&#9;default:" line56="                    tiles.setTilemap(tiles.createTilemap(hex`0a0008000301010101010201010100010101010100010101000101010101000101010001010101010001010100010101010100010101000101010101000101010200000000000201010101010101010101010101`, img`" line57="                        . . . . . . . . . ." line58="                        . . . . . . . . . ." line59="                        . . . . . . . . . ." line60="                        . . . . . . . . . ." line61="                        . . . . . . . . . ." line62="                        . . . . . . . . . ." line63="                        . . . . . . . . . ." line64="                        . . . . . . . . . ." line65="                    `, [myTiles.transparency16,sprites.builtin.forestTiles0,sprites.dungeon.collectibleInsignia,sprites.dungeon.buttonTealDepressed], TileScale.Sixteen))" line66="   " line67="&#9;&#9;&#9;&#9;&#9;break;" line68="&#9;&#9;&#9;}    " line69="}" line70="" line71="" line72="//变量声明" line73="let gem: Sprite = null" line74="let gemsHero: Sprite = null" line75="let heroDirection = 0" line76="let gemsNum = 0 " line77="let level = 1" line78="let heroRow = 0" line79="let heroCol =0" line80="heroDirection = 0" line81="export enum turnDirection{" line82="    left," line83="    right" line84="    }" line85="" line86="   //初始化" line87="    //%block" line88="    //%group=&quot;operate&quot;" line89="    export function initGame(){ " line90="        gemsHero = sprites.create(img`" line91="    . . . . . . f f f f . . . . . ." line92="    . . . . f f f 2 2 f f f . . . ." line93="    . . . f f f 2 2 2 2 f f f . . ." line94="    . . f f f e e e e e e f f f . ." line95="    . . f f e 2 2 2 2 2 2 e e f . ." line96="    . . f e 2 f f f f f f 2 e f . ." line97="    . . f f f f e e e e f f f f . ." line98="    . f f e f b f 4 4 f b f e f f ." line99="    . f e e 4 1 f d d f 1 4 e e f ." line100="    . . f e e d d d d d d e e f . ." line101="    . . . f e e 4 4 4 4 e e f . . ." line102="    . . e 4 f 2 2 2 2 2 2 f 4 e . ." line103="    . . 4 d f 2 2 2 2 2 2 f d 4 . ." line104="    . . 4 4 f 4 4 5 5 4 4 f 4 4 . ." line105="    . . . . . f f f f f f . . . . ." line106="    . . . . . f f . . f f . . . . ." line107="`, SpriteKind.gemsPlayer)" line108="        level = game.askForNumber(&quot;set level&quot;)" line109="        levelset(level)" line110="    tiles.placeOnRandomTile(gemsHero, img`" line111="        b b b b b b b b b b b b b b b b" line112="        b c b b b b b b b b b b b b c b" line113="        b b b c 6 6 6 6 6 6 6 6 c b b b" line114="        b b c 6 6 6 6 6 6 6 6 6 6 c b b" line115="        b b 6 6 6 6 6 6 6 6 6 6 6 6 b b" line116="        b b 6 6 6 6 6 6 6 6 6 6 6 6 b b" line117="        b b 6 6 6 6 6 6 6 6 6 6 6 6 b b" line118="        b b 6 6 6 6 6 6 6 6 6 6 6 6 b b" line119="        b b 6 6 6 6 6 6 6 6 6 6 6 6 b b" line120="        b b 9 6 6 6 6 6 6 6 6 6 6 9 b b" line121="        b b 9 6 6 6 6 6 6 6 6 6 6 9 b b" line122="        b b 6 9 6 6 6 6 6 6 6 6 9 6 b b" line123="        b b c 6 9 9 9 9 9 9 9 9 6 c b b" line124="        b b b c c c c c c c c c c b b b" line125="        b c b b b b b b b b b b b b c b" line126="        b b b b b b b b b b b b b b b b" line127="    `)" line128="    for (let 值 of tiles.getTilesByType(sprites.dungeon.collectibleInsignia)) {" line129="        gem = sprites.create(img`" line130="            . . . . . . . . . . . . . . . ." line131="            . . . . . . 4 4 4 4 . . . . . ." line132="            . . . . 4 4 4 5 5 4 4 4 . . . ." line133="            . . . 3 3 3 3 4 4 4 4 4 4 . . ." line134="            . . 4 3 3 3 3 2 2 2 1 1 4 4 . ." line135="            . . 3 3 3 3 3 2 2 2 1 1 5 4 . ." line136="            . 4 3 3 3 3 2 2 2 2 2 5 5 4 4 ." line137="            . 4 3 3 3 2 2 2 4 4 4 4 5 4 4 ." line138="            . 4 4 3 3 2 2 4 4 4 4 4 4 4 4 ." line139="            . 4 2 3 3 2 2 4 4 4 4 4 4 4 4 ." line140="            . . 4 2 3 3 2 4 4 4 4 4 2 4 . ." line141="            . . 4 2 2 3 2 2 4 4 4 2 4 4 . ." line142="            . . . 4 2 2 2 2 2 2 2 2 4 . . ." line143="            . . . . 4 4 2 2 2 2 4 4 . . . ." line144="            . . . . . . 4 4 4 4 . . . . . ." line145="            . . . . . . . . . . . . . . . ." line146="        `, SpriteKind.gemsKind)" line147="        tiles.placeOnTile(gem, 值)" line148="        gemsNum+=1" line149="        info.player1.setScore(gemsNum)" line150="    }" line151="    gemsHero.z = 1000" line152="    let heroX = gemsHero.x" line153="    let heroY = gemsHero.y" line154="    heroRow = gemsHero.y/16-0.5" line155="    heroCol =gemsHero.x/16-0.5" line156="    gemsHero.say(&quot;改程序前，先画流程图&quot;)" line157="}" line158="    //获得宝石" line159="    //%block" line160="    //%group=&quot;operate&quot;" line161="    export function takeGems(){" line162="    gemsHero.setKind(SpriteKind.getGemsKind)" line163="    pause(100)" line164="    music.baDing.play()" line165="    gemsHero.setFlag(SpriteFlag.Ghost, true)" line166="    gemsHero.y-=5" line167="    pause(100)" line168="    gemsHero.setKind(SpriteKind.gemsPlayer)" line169="    gemsHero.setFlag(SpriteFlag.Ghost, false)" line170="    gemsHero.y+=5" line171="    if(gemsNum==0){" line172="        game.over(true)" line173="    }" line174="}" line175="" line176="    //转向" line177="    //%block=&quot;turn %turnDirection&quot;" line178="    //%group=&quot;move&quot;" line179="    export function turn (choice: turnDirection) {" line180="    // if (choice==right) {" line181="    //     heroDirection += 1" line182="    //     heroDirection = heroDirection % 4" line183="    // } else {" line184="    //     heroDirection += 3" line185="    //     heroDirection = heroDirection % 4" line186="    // }" line187="    switch(choice){" line188="        case turnDirection.right:" line189="        heroDirection += 1" line190="        heroDirection = heroDirection % 4" line191="        break" line192="        default :" line193="        heroDirection += 3" line194="        heroDirection = heroDirection % 4" line195="        break" line196="    }" line197="    if (heroDirection == 3) {" line198="        gemsHero.setImage(img`" line199="            . . . . . . f f f f f f . . . . " line200="            . . . . f f e e e e f 2 f . . . " line201="            . . . f f e e e e f 2 2 2 f . . " line202="            . . . f e e e f f e e e e f . . " line203="            . . . f f f f e e 2 2 2 2 e f . " line204="            . . . f e 2 2 2 f f f f e 2 f . " line205="            . . f f f f f f f e e e f f f . " line206="            . . f f e 4 4 e b f 4 4 e e f . " line207="            . . f e e 4 d 4 1 f d d e f . . " line208="            . . . f e e e 4 d d d d f . . . " line209="            . . . . f f e e 4 4 4 e f . . . " line210="            . . . . . 4 d d e 2 2 2 f . . . " line211="            . . . . . e d d e 2 2 2 f . . . " line212="            . . . . . f e e f 4 5 5 f . . . " line213="            . . . . . . f f f f f f . . . . " line214="            . . . . . . . f f f . . . . . . " line215="            `)" line216="    } else if (heroDirection == 0) {" line217="        gemsHero.setImage(img`" line218="            . . . . . . f f f f . . . . . . " line219="            . . . . f f f 2 2 f f f . . . . " line220="            . . . f f f 2 2 2 2 f f f . . . " line221="            . . f f f e e e e e e f f f . . " line222="            . . f f e 2 2 2 2 2 2 e e f . . " line223="            . . f e 2 f f f f f f 2 e f . . " line224="            . . f f f f e e e e f f f f . . " line225="            . f f e f b f 4 4 f b f e f f . " line226="            . f e e 4 1 f d d f 1 4 e e f . " line227="            . . f e e d d d d d d e e f . . " line228="            . . . f e e 4 4 4 4 e e f . . . " line229="            . . e 4 f 2 2 2 2 2 2 f 4 e . . " line230="            . . 4 d f 2 2 2 2 2 2 f d 4 . . " line231="            . . 4 4 f 4 4 5 5 4 4 f 4 4 . . " line232="            . . . . . f f f f f f . . . . . " line233="            . . . . . f f . . f f . . . . . " line234="            `)" line235="    } else if (heroDirection == 1) {" line236="        gemsHero.setImage(img`" line237="            . . . . f f f f f f . . . . . . " line238="            . . . f 2 f e e e e f f . . . . " line239="            . . f 2 2 2 f e e e e f f . . . " line240="            . . f e e e e f f e e e f . . . " line241="            . f e 2 2 2 2 e e f f f f . . . " line242="            . f 2 e f f f f 2 2 2 e f . . . " line243="            . f f f e e e f f f f f f f . . " line244="            . f e e 4 4 f b e 4 4 e f f . . " line245="            . . f e d d f 1 4 d 4 e e f . . " line246="            . . . f d d d d 4 e e e f . . . " line247="            . . . f e 4 4 4 e e f f . . . . " line248="            . . . f 2 2 2 e d d 4 . . . . . " line249="            . . . f 2 2 2 e d d e . . . . . " line250="            . . . f 5 5 4 f e e f . . . . . " line251="            . . . . f f f f f f . . . . . . " line252="            . . . . . . f f f . . . . . . . " line253="            `)" line254="    } else if (heroDirection == 2) {" line255="        gemsHero.setImage(img`" line256="            . . . . . . f f f f . . . . . . " line257="            . . . . f f e e e e f f . . . . " line258="            . . . f e e e f f e e e f . . . " line259="            . . f f f f f 2 2 f f f f f . . " line260="            . . f f e 2 e 2 2 e 2 e f f . . " line261="            . . f e 2 f 2 f f 2 f 2 e f . . " line262="            . . f f f 2 2 e e 2 2 f f f . . " line263="            . f f e f 2 f e e f 2 f e f f . " line264="            . f e e f f e e e e f e e e f . " line265="            . . f e e e e e e e e e e f . . " line266="            . . . f e e e e e e e e f . . . " line267="            . . e 4 f f f f f f f f 4 e . . " line268="            . . 4 d f 2 2 2 2 2 2 f d 4 . . " line269="            . . 4 4 f 4 4 4 4 4 4 f 4 4 . . " line270="            . . . . . f f f f f f . . . . . " line271="            . . . . . f f . . f f . . . . . " line272="            `)" line273="    }" line274="    pause(500)" line275="}" line276="    //前进" line277="    //%block" line278="    //%group=&quot;move&quot;" line279="    export function stepForward () {" line280="    if (heroDirection == 3) {" line281="        heroRow += 1" line282="    } else if (heroDirection == 0) {" line283="        heroCol += 1" line284="    } else if (heroDirection == 1) {" line285="        heroRow += -1" line286="    } else if (heroDirection == 2) {" line287="        heroCol += -1" line288="    }" line289="    tiles.placeOnTile(gemsHero, tiles.getTileLocation(heroRow, heroCol))" line290="    pause(500)" line291="}" line292="" line293="" line294="}" numlines="295"></mutation></block></statement></block></xml>