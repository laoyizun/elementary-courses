<xml xmlns="https://developers.google.com/blockly/xml"><variables><variable type="KIND_SpriteKind" id="/l~a}BnXFxHe(lJJ5{Yw">gemsPlayer</variable><variable type="KIND_SpriteKind" id="%PMMJ83LAqsco*-^)N6^">gemsCatcher</variable><variable type="KIND_SpriteKind" id="B`ZUHjP/5g{Pt_oflF4.">gems</variable><variable type="KIND_SpriteKind" id="cm={Y{(AsXkAmg4b:nNt">getGemsKind</variable><variable type="KIND_SpriteKind" id="TX#~s8)*SltAE8*!/=U%">gemsKind</variable></variables><block type="pxt-on-start" id="yP}=/YaTpHBvmeJd=9CE" x="0" y="0"><statement name="HANDLER"><block type="typescript_statement" id="=*8z;!%!QtY;;?{;EZ=+" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="namespace getgems {" line1="" line2="//碰到墙回退事件" line3="scene.onOverlapTile(SpriteKind.gemsPlayer, sprites.builtin.forestTiles0, function (sprite, location) {" line4="    if (heroDirection == 3) {" line5="        heroRow += -1" line6="    } else if (heroDirection == 0) {" line7="        heroCol += -1" line8="    } else if (heroDirection == 1) {" line9="        heroRow += 1" line10="    } else if (heroDirection == 2) {" line11="        heroCol += 1" line12="    }" line13="    scene.cameraShake(4, 500)" line14="    tiles.placeOnTile(gemsHero, tiles.getTileLocation(heroRow, heroCol))" line15="})" line16="" line17="//获得宝石事件" line18="sprites.onOverlap(SpriteKind.gemsCatcher, SpriteKind.gems, function(sprite: Sprite, otherSprite: Sprite) {" line19="    otherSprite.destroy()" line20="    info.player1.changeScoreBy(-1)" line21="})" line22="sprites.onOverlap(SpriteKind.getGemsKind, SpriteKind.gemsKind, function(sprite: Sprite, otherSprite: Sprite) {" line23="    otherSprite.destroy()" line24="    info.player1.changeScoreBy(-1)" line25="    gemsNum-=1" line26="})" line27="" line28="//关卡设定" line29="function levelset(level:number){" line30="   switch(level){" line31="&#9;&#9;&#9;&#9;case 1:" line32="                     tiles.setTilemap(tiles.createTilemap(hex`0a0008000202020202020202020202020202020202020202020202020202020202020202020102020202020202020203020202020202020202020202020202020202020202020202020202020202020202020202`, img`" line33="                         . . . . . . . . . ." line34="                         . . . . . . . . . ." line35="                         . . . . . . . . . ." line36="                         . . . . . . . . . ." line37="                         . . . . . . . . . ." line38="                         . . . . . . . . . ." line39="                         . . . . . . . . . ." line40="                         . . . . . . . . . ." line41="                     `, [myTiles.transparency16,sprites.dungeon.buttonTealDepressed,sprites.builtin.forestTiles0,sprites.dungeon.collectibleInsignia], TileScale.Sixteen))   " line42="&#9;&#9;&#9;&#9;&#9;break;" line43="&#9;&#9;&#9;&#9;case 2:" line44="                    tiles.setTilemap(tiles.createTilemap(hex`0a0008000101010101010101010101010101010101010101010101030000000001010101010000010002010101010101020100010101010101010000000101010101010101010101010101010101010101010101`, img`" line45="                        . . . . . . . . . ." line46="                        . . . . . . . . . ." line47="                        . . . . . . . . . ." line48="                        . . . . . . . . . ." line49="                        . . . . . . . . . ." line50="                        . . . . . . . . . ." line51="                        . . . . . . . . . ." line52="                        . . . . . . . . . ." line53="                    `, [myTiles.transparency16,sprites.builtin.forestTiles0,sprites.dungeon.collectibleInsignia,sprites.dungeon.buttonTealDepressed], TileScale.Sixteen))" line54="                    break;" line55="&#9;&#9;&#9;&#9;default:" line56="                    tiles.setTilemap(tiles.createTilemap(hex`0a0008000301010101010201010100010101010100010101000101010101000101010001010101010001010100010101010100010101000101010101000101010200000000000201010101010101010101010101`, img`" line57="                        . . . . . . . . . ." line58="                        . . . . . . . . . ." line59="                        . . . . . . . . . ." line60="                        . . . . . . . . . ." line61="                        . . . . . . . . . ." line62="                        . . . . . . . . . ." line63="                        . . . . . . . . . ." line64="                        . . . . . . . . . ." line65="                    `, [myTiles.transparency16,sprites.builtin.forestTiles0,sprites.dungeon.collectibleInsignia,sprites.dungeon.buttonTealDepressed], TileScale.Sixteen))" line66="   " line67="&#9;&#9;&#9;&#9;&#9;break;" line68="&#9;&#9;&#9;}    " line69="}" line70="" line71="" line72="//变量声明" line73="let gem: Sprite = null" line74="let gemsHero: Sprite = null" line75="let heroDirection = 0" line76="let gemsNum = 0 " line77="let level = 1" line78="let heroRow = 0" line79="let heroCol =0" line80="heroDirection = 0" line81="export enum turnDirection{" line82="    left," line83="    right" line84="    }" line85="" line86="   //初始化" line87="    //%block" line88="    //%group=&quot;operate&quot;" line89="    export function initGame(){ " line90="        gemsHero = sprites.create(img`" line91="    . . . . . . f f f f . . . . . ." line92="    . . . . f f f 2 2 f f f . . . ." line93="    . . . f f f 2 2 2 2 f f f . . ." line94="    . . f f f e e e e e e f f f . ." line95="    . . f f e 2 2 2 2 2 2 e e f . ." line96="    . . f e 2 f f f f f f 2 e f . ." line97="    . . f f f f e e e e f f f f . ." line98="    . f f e f b f 4 4 f b f e f f ." line99="    . f e e 4 1 f d d f 1 4 e e f ." line100="    . . f e e d d d d d d e e f . ." line101="    . . . f e e 4 4 4 4 e e f . . ." line102="    . . e 4 f 2 2 2 2 2 2 f 4 e . ." line103="    . . 4 d f 2 2 2 2 2 2 f d 4 . ." line104="    . . 4 4 f 4 4 5 5 4 4 f 4 4 . ." line105="    . . . . . f f f f f f . . . . ." line106="    . . . . . f f . . f f . . . . ." line107="`, SpriteKind.gemsPlayer)" line108="        level = game.askForNumber(&quot;set level&quot;)" line109="        levelset(level)" line110="    tiles.placeOnRandomTile(gemsHero, img`" line111="        b b b b b b b b b b b b b b b b" line112="        b c b b b b b b b b b b b b c b" line113="        b b b c 6 6 6 6 6 6 6 6 c b b b" line114="        b b c 6 6 6 6 6 6 6 6 6 6 c b b" line115="        b b 6 6 6 6 6 6 6 6 6 6 6 6 b b" line116="        b b 6 6 6 6 6 6 6 6 6 6 6 6 b b" line117="        b b 6 6 6 6 6 6 6 6 6 6 6 6 b b" line118="        b b 6 6 6 6 6 6 6 6 6 6 6 6 b b" line119="        b b 6 6 6 6 6 6 6 6 6 6 6 6 b b" line120="        b b 9 6 6 6 6 6 6 6 6 6 6 9 b b" line121="        b b 9 6 6 6 6 6 6 6 6 6 6 9 b b" line122="        b b 6 9 6 6 6 6 6 6 6 6 9 6 b b" line123="        b b c 6 9 9 9 9 9 9 9 9 6 c b b" line124="        b b b c c c c c c c c c c b b b" line125="        b c b b b b b b b b b b b b c b" line126="        b b b b b b b b b b b b b b b b" line127="    `)" line128="    for (let 值 of tiles.getTilesByType(sprites.dungeon.collectibleInsignia)) {" line129="        gem = sprites.create(img`" line130="            . . . . . . . . . . . . . . . ." line131="            . . . . . . 4 4 4 4 . . . . . ." line132="            . . . . 4 4 4 5 5 4 4 4 . . . ." line133="            . . . 3 3 3 3 4 4 4 4 4 4 . . ." line134="            . . 4 3 3 3 3 2 2 2 1 1 4 4 . ." line135="            . . 3 3 3 3 3 2 2 2 1 1 5 4 . ." line136="            . 4 3 3 3 3 2 2 2 2 2 5 5 4 4 ." line137="            . 4 3 3 3 2 2 2 4 4 4 4 5 4 4 ." line138="            . 4 4 3 3 2 2 4 4 4 4 4 4 4 4 ." line139="            . 4 2 3 3 2 2 4 4 4 4 4 4 4 4 ." line140="            . . 4 2 3 3 2 4 4 4 4 4 2 4 . ." line141="            . . 4 2 2 3 2 2 4 4 4 2 4 4 . ." line142="            . . . 4 2 2 2 2 2 2 2 2 4 . . ." line143="            . . . . 4 4 2 2 2 2 4 4 . . . ." line144="            . . . . . . 4 4 4 4 . . . . . ." line145="            . . . . . . . . . . . . . . . ." line146="        `, SpriteKind.gemsKind)" line147="        tiles.placeOnTile(gem, 值)" line148="        gemsNum+=1" line149="        info.player1.setScore(gemsNum)" line150="    }" line151="    gemsHero.z = 1000" line152="    let heroX = gemsHero.x" line153="    let heroY = gemsHero.y" line154="    heroRow = gemsHero.y/16-0.5" line155="    heroCol =gemsHero.x/16-0.5" line156="    gemsHero.say(&quot;改程序前，先画流程图&quot;)" line157="}" line158="    //获得宝石" line159="    //%block" line160="    //%group=&quot;operate&quot;" line161="    export function takeGems(){" line162="    gemsHero.setKind(SpriteKind.getGemsKind)" line163="    pause(100)" line164="    music.baDing.play()" line165="    gemsHero.setFlag(SpriteFlag.Ghost, true)" line166="    gemsHero.y-=5" line167="    pause(100)" line168="    gemsHero.setKind(SpriteKind.gemsPlayer)" line169="    gemsHero.setFlag(SpriteFlag.Ghost, false)" line170="    gemsHero.y+=5" line171="    if(gemsNum==0){" line172="        " line173="         level+=1" line174="        initGame()" line175="    }" line176="}" line177="" line178="    //转向" line179="    //%block=&quot;turn %turnDirection&quot;" line180="    //%group=&quot;move&quot;" line181="    export function turn (choice: turnDirection) {" line182="    // if (choice==right) {" line183="    //     heroDirection += 1" line184="    //     heroDirection = heroDirection % 4" line185="    // } else {" line186="    //     heroDirection += 3" line187="    //     heroDirection = heroDirection % 4" line188="    // }" line189="    switch(choice){" line190="        case turnDirection.right:" line191="        heroDirection += 1" line192="        heroDirection = heroDirection % 4" line193="        break" line194="        default :" line195="        heroDirection += 3" line196="        heroDirection = heroDirection % 4" line197="        break" line198="    }" line199="    if (heroDirection == 3) {" line200="        gemsHero.setImage(img`" line201="            . . . . . . f f f f f f . . . . " line202="            . . . . f f e e e e f 2 f . . . " line203="            . . . f f e e e e f 2 2 2 f . . " line204="            . . . f e e e f f e e e e f . . " line205="            . . . f f f f e e 2 2 2 2 e f . " line206="            . . . f e 2 2 2 f f f f e 2 f . " line207="            . . f f f f f f f e e e f f f . " line208="            . . f f e 4 4 e b f 4 4 e e f . " line209="            . . f e e 4 d 4 1 f d d e f . . " line210="            . . . f e e e 4 d d d d f . . . " line211="            . . . . f f e e 4 4 4 e f . . . " line212="            . . . . . 4 d d e 2 2 2 f . . . " line213="            . . . . . e d d e 2 2 2 f . . . " line214="            . . . . . f e e f 4 5 5 f . . . " line215="            . . . . . . f f f f f f . . . . " line216="            . . . . . . . f f f . . . . . . " line217="            `)" line218="    } else if (heroDirection == 0) {" line219="        gemsHero.setImage(img`" line220="            . . . . . . f f f f . . . . . . " line221="            . . . . f f f 2 2 f f f . . . . " line222="            . . . f f f 2 2 2 2 f f f . . . " line223="            . . f f f e e e e e e f f f . . " line224="            . . f f e 2 2 2 2 2 2 e e f . . " line225="            . . f e 2 f f f f f f 2 e f . . " line226="            . . f f f f e e e e f f f f . . " line227="            . f f e f b f 4 4 f b f e f f . " line228="            . f e e 4 1 f d d f 1 4 e e f . " line229="            . . f e e d d d d d d e e f . . " line230="            . . . f e e 4 4 4 4 e e f . . . " line231="            . . e 4 f 2 2 2 2 2 2 f 4 e . . " line232="            . . 4 d f 2 2 2 2 2 2 f d 4 . . " line233="            . . 4 4 f 4 4 5 5 4 4 f 4 4 . . " line234="            . . . . . f f f f f f . . . . . " line235="            . . . . . f f . . f f . . . . . " line236="            `)" line237="    } else if (heroDirection == 1) {" line238="        gemsHero.setImage(img`" line239="            . . . . f f f f f f . . . . . . " line240="            . . . f 2 f e e e e f f . . . . " line241="            . . f 2 2 2 f e e e e f f . . . " line242="            . . f e e e e f f e e e f . . . " line243="            . f e 2 2 2 2 e e f f f f . . . " line244="            . f 2 e f f f f 2 2 2 e f . . . " line245="            . f f f e e e f f f f f f f . . " line246="            . f e e 4 4 f b e 4 4 e f f . . " line247="            . . f e d d f 1 4 d 4 e e f . . " line248="            . . . f d d d d 4 e e e f . . . " line249="            . . . f e 4 4 4 e e f f . . . . " line250="            . . . f 2 2 2 e d d 4 . . . . . " line251="            . . . f 2 2 2 e d d e . . . . . " line252="            . . . f 5 5 4 f e e f . . . . . " line253="            . . . . f f f f f f . . . . . . " line254="            . . . . . . f f f . . . . . . . " line255="            `)" line256="    } else if (heroDirection == 2) {" line257="        gemsHero.setImage(img`" line258="            . . . . . . f f f f . . . . . . " line259="            . . . . f f e e e e f f . . . . " line260="            . . . f e e e f f e e e f . . . " line261="            . . f f f f f 2 2 f f f f f . . " line262="            . . f f e 2 e 2 2 e 2 e f f . . " line263="            . . f e 2 f 2 f f 2 f 2 e f . . " line264="            . . f f f 2 2 e e 2 2 f f f . . " line265="            . f f e f 2 f e e f 2 f e f f . " line266="            . f e e f f e e e e f e e e f . " line267="            . . f e e e e e e e e e e f . . " line268="            . . . f e e e e e e e e f . . . " line269="            . . e 4 f f f f f f f f 4 e . . " line270="            . . 4 d f 2 2 2 2 2 2 f d 4 . . " line271="            . . 4 4 f 4 4 4 4 4 4 f 4 4 . . " line272="            . . . . . f f f f f f . . . . . " line273="            . . . . . f f . . f f . . . . . " line274="            `)" line275="    }" line276="    pause(500)" line277="}" line278="    //前进" line279="    //%block" line280="    //%group=&quot;move&quot;" line281="    export function stepForward () {" line282="    if (heroDirection == 3) {" line283="        heroRow += 1" line284="    } else if (heroDirection == 0) {" line285="        heroCol += 1" line286="    } else if (heroDirection == 1) {" line287="        heroRow += -1" line288="    } else if (heroDirection == 2) {" line289="        heroCol += -1" line290="    }" line291="    tiles.placeOnTile(gemsHero, tiles.getTileLocation(heroRow, heroCol))" line292="    pause(500)" line293="}" line294="" line295="" line296="}" numlines="297"></mutation><next><block type="getgems_initGame" id="zNAy/0sLvg-A{3z4cx]C"/></next></block></statement></block></xml>